@model HotelBookingSystem.ViewModels.Booking.BookingViewModel
@{
    ViewData["Title"] = "Đặt phòng";
}

@section Styles {
    <link rel="stylesheet" href="~/css/booking-page.css" />
    <style>
        /* Simple, clean booking page styles */
        .simple-booking-page {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 0;
        }
        
        .booking-container {
            width: 100%;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }
        
        .booking-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .booking-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .booking-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .booking-content {
            padding: 40px 60px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px 30px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        
        .section-title {
            color: #495057;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-label {
            color: #495057;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .input-group-text {
            background: #667eea;
            color: white;
            border: 2px solid #667eea;
            font-weight: 500;
        }
        
        .payment-methods {
            display: grid;
            gap: 15px;
        }
        
        .payment-method {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .payment-method:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .payment-method.active {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .payment-method.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .payment-icon {
            width: 50px;
            height: 50px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .payment-info h6 {
            margin: 0 0 5px 0;
            color: #495057;
            font-weight: 600;
        }
        
        .payment-info p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .booking-summary {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            position: sticky;
            top: 20px;
        }
        
        .summary-title {
            color: #495057;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .room-preview img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .room-name {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .room-type {
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .summary-row:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 16px;
            color: #667eea;
        }
        
        .contact-support {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }
        
        .contact-support .phone {
            color: #1976d2;
            font-weight: 600;
            font-size: 18px;
        }
        
        @@media (max-width: 768px) {
            .booking-content {
                padding: 20px 15px;
            }
            
            .booking-header {
                padding: 20px 15px;
            }
            
            .booking-header h1 {
                font-size: 24px;
            }
        }
        
        @@media (min-width: 1400px) {
            .booking-content {
                max-width: 1600px;
                padding: 40px 80px;
            }
            
            .form-section {
                padding: 30px 40px;
            }
        }
        
        @@media (min-width: 1900px) {
            .booking-content {
                max-width: 1800px;
                padding: 40px 100px;
            }
        }
    </style>
}

<div class="simple-booking-page">
    <div class="booking-container">
        <!-- Simple Header -->
        <div class="booking-header">
            <h1>Đặt phòng khách sạn</h1>
            <p>Vui lòng điền thông tin để hoàn tất đặt phòng</p>
        </div>

        
        <!-- Main Content -->
        <div class="booking-content">
            <div class="row">
                <div class="col-lg-8 col-xl-9">
                    <form method="post" asp-action="Create" asp-controller="Bookings">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                        <input type="hidden" asp-for="RoomId" />

                        <!-- Progress Indicator -->
                        <div class="booking-progress-container mb-4">
                            <div class="booking-progress-card">
                                <div class="progress-header text-center mb-3">
                                    <h5 class="mb-1">
                                        <i class="fas fa-tasks text-white me-2"></i>
                                        Tiến trình đặt phòng
                                    </h5>
                                    <small class="text-white-50">Hoàn thành thông tin để đặt phòng</small>
                                </div>
                                <div class="progress-steps">
                                    <div class="step-item active" data-step="1">
                                        <div class="step-circle">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                        <span class="step-label">Thông tin lưu trú</span>
                                    </div>
                                    <div class="step-connector"></div>
                                    <div class="step-item" data-step="2">
                                        <div class="step-circle">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <span class="step-label">Thông tin khách hàng</span>
                                    </div>
                                    <div class="step-connector"></div>
                                    <div class="step-item" data-step="3">
                                        <div class="step-circle">
                                            <i class="fas fa-credit-card"></i>
                                        </div>
                                        <span class="step-label">Thanh toán</span>
                                    </div>
                                    <div class="step-connector"></div>
                                    <div class="step-item" data-step="4">
                                        <div class="step-circle">
                                            <i class="fas fa-check"></i>
                                        </div>
                                        <span class="step-label">Hoàn tất</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Thông tin lưu trú -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-calendar-check text-primary"></i>
                                Thông tin lưu trú
                            </h3>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="CheckInDate" class="form-label">Ngày nhận phòng</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                        <input asp-for="CheckInDate" type="date" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="CheckInDate" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="CheckOutDate" class="form-label">Ngày trả phòng</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                        <input asp-for="CheckOutDate" type="date" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="CheckOutDate" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="GuestCount" class="form-label">Số khách</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-users"></i></span>
                                        <select asp-for="GuestCount" class="form-select" required>
                                            <option value="">Chọn số khách</option>
                                            @for (int i = 1; i <= Model.MaxGuests; i++)
                                            {
                                                <option value="@i" selected="@(Model.GuestCount == i ? "selected" : null)">@i khách</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-info-circle text-primary"></i>
                                        Phòng này có thể chứa tối đa @Model.MaxGuests khách
                                    </div>
                                    <span asp-validation-for="GuestCount" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="SpecialRequests" class="form-label">Yêu cầu đặc biệt (không bắt buộc)</label>
                                <textarea asp-for="SpecialRequests" class="form-control" rows="3" placeholder="Ví dụ: Phòng tầng cao, gần thang máy..."></textarea>
                            </div>
                        </div>

                        <!-- Thông tin khách hàng -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user text-primary"></i>
                                Thông tin khách hàng
                            </h3>

                            <!-- Thông báo về việc chỉnh sửa thông tin -->
                            <div class="alert alert-info d-flex align-items-center" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                <div>
                                    <strong>Thông tin cá nhân:</strong> Thông tin này được lấy từ hồ sơ của bạn. 
                                    <a href="@Url.Action("Profile", "Account")" class="alert-link" target="_blank">
                                        <i class="fas fa-edit"></i> Cập nhật thông tin cá nhân
                                    </a>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="FirstName" class="form-label">Tên</label>
                                    <input asp-for="FirstName" type="text" class="form-control bg-light" readonly />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="LastName" class="form-label">Họ</label>
                                    <input asp-for="LastName" type="text" class="form-control bg-light" readonly />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Email" class="form-label">Email</label>
                                    <div class="input-group">
                                        <span class="input-group-text">@@</span>
                                        <input asp-for="Email" type="email" class="form-control bg-light" readonly />
                                    </div>
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Phone" class="form-label">Số điện thoại</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                        <input asp-for="Phone" type="tel" class="form-control bg-light" readonly />
                                    </div>
                                    <span asp-validation-for="Phone" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Phương thức thanh toán -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-credit-card text-primary"></i>
                                Phương thức thanh toán
                            </h3>

                            <div class="payment-methods">
                                <div class="payment-method active">
                                    <input type="radio" id="hotel-payment" name="PaymentMethod" value="Hotel" checked style="display: none;" />
                                    <label for="hotel-payment" style="cursor: pointer; display: flex; align-items: center; gap: 15px; width: 100%; margin: 0;">
                                        <div class="payment-icon">
                                            <i class="fas fa-hotel"></i>
                                        </div>
                                        <div class="payment-info">
                                            <h6>Thanh toán tại khách sạn</h6>
                                            <p>Thanh toán trực tiếp tại quầy lễ tân khi nhận phòng</p>
                                        </div>
                                        <span class="badge bg-success ms-auto">Khuyến nghị</span>
                                    </label>
                                </div>

                                <div class="payment-method disabled">
                                    <div class="payment-icon" style="background: #6c757d;">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    <div class="payment-info">
                                        <h6>Thẻ tín dụng</h6>
                                        <p>Thanh toán online bằng thẻ tín dụng</p>
                                    </div>
                                    <span class="badge bg-secondary ms-auto">Sắp có</span>
                                </div>
                            </div>
                        </div>

                        <!-- Điều khoản -->
                        <div class="form-section">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms-agreement" required>
                                <label class="form-check-label" for="terms-agreement">
                                    Tôi đồng ý với <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#termsModal">Điều khoản và điều kiện</a> của khách sạn
                                </label>
                            </div>
                        </div>

                        <!-- Nút hành động -->
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="javascript:history.back()" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Quay lại
                            </a>
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-check"></i>
                                Hoàn tất đặt phòng
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Sidebar - Tóm tắt đặt phòng -->
                <div class="col-lg-4 col-xl-3">
                    <div class="booking-summary">
                        <h5 class="summary-title">Tóm tắt đặt phòng</h5>
                        
                        <!-- Thông tin phòng -->
                        <div class="room-preview">
                            <img src="@Model.RoomImageUrl" alt="@Model.RoomName" class="img-fluid">
                            <h6 class="room-name">@Model.RoomName</h6>
                            <p class="room-type">@Model.RoomType</p>
                        </div>

                        <!-- Chi tiết đặt phòng -->
                        <div class="summary-details">
                            <div class="summary-row">
                                <span>Ngày nhận phòng:</span>
                                <span id="summary-checkin">Chưa chọn</span>
                            </div>
                            <div class="summary-row">
                                <span>Ngày trả phòng:</span>
                                <span id="summary-checkout">Chưa chọn</span>
                            </div>
                            <div class="summary-row">
                                <span>Số đêm:</span>
                                <span id="summary-nights">0</span>
                            </div>
                            <div class="summary-row">
                                <span>Số khách:</span>
                                <span id="summary-guests">Chưa chọn</span>
                            </div>
                            <div class="summary-row">
                                <span>Giá phòng/đêm:</span>
                                <span>@Model.RoomPrice.ToString("N0") VNĐ</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Tổng cộng:</strong></span>
                                <span><strong id="summary-total">0₫</strong></span>
                            </div>
                        </div>

                        <!-- Hỗ trợ khách hàng -->
                        <div class="contact-support">
                            <i class="fas fa-headset text-primary mb-2" style="font-size: 24px;"></i>
                            <p class="mb-1">Cần hỗ trợ?</p>
                            <p class="phone">Hotline: 1900 1234</p>
                            <div class="support-hours">
                                <small class="text-muted">
                                    <i class="fas fa-clock"></i> 24/7 - Hỗ trợ mọi lúc
                                </small>
                            </div>
                        </div>

                        <!-- Thông tin hữu ích -->
                        <div class="helpful-info-card mt-4">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Thông tin hữu ích
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="info-grid">
                                    <div class="info-card">
                                        <div class="info-icon">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="info-content">
                                            <h6>Giờ nhận/trả phòng</h6>
                                            <p class="mb-1"><strong>Nhận:</strong> 14:00 - 23:00</p>
                                            <p class="mb-0"><strong>Trả:</strong> 06:00 - 12:00</p>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card wifi">
                                        <div class="info-icon wifi">
                                            <i class="fas fa-wifi"></i>
                                        </div>
                                        <div class="info-content">
                                            <h6>WiFi miễn phí</h6>
                                            <p class="mb-0">Tốc độ cao trong toàn bộ khách sạn</p>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card parking">
                                        <div class="info-icon parking">
                                            <i class="fas fa-car"></i>
                                        </div>
                                        <div class="info-content">
                                            <h6>Đỗ xe miễn phí</h6>
                                            <p class="mb-0">Bãi đỗ xe an toàn 24/7</p>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card breakfast">
                                        <div class="info-icon breakfast">
                                            <i class="fas fa-utensils"></i>
                                        </div>
                                        <div class="info-content">
                                            <h6>Ưu đãi bữa sáng</h6>
                                            <p class="mb-0">Giảm 20% cho khách lưu trú</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chính sách hủy phòng -->
                        <div class="cancellation-policy-card mt-4">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-calendar-times text-warning me-2"></i>
                                    Chính sách hủy phòng
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="policy-list">
                                    <div class="policy-item-card success">
                                        <div class="policy-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="policy-text">
                                            <strong>Hủy miễn phí</strong>
                                            <span>trước 24 giờ</span>
                                        </div>
                                    </div>
                                    <div class="policy-item-card warning">
                                        <div class="policy-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="policy-text">
                                            <strong>Phí 50%</strong>
                                            <span>hủy trong 24 giờ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal điều khoản và điều kiện -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">
                    <i class="fas fa-file-contract text-primary me-2"></i>
                    Điều khoản và điều kiện
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="terms-content">
                    <h6 class="text-primary">1. Điều khoản đặt phòng</h6>
                    <ul>
                        <li>Khách hàng phải từ 18 tuổi trở lên để thực hiện đặt phòng</li>
                        <li>Thông tin đặt phòng phải chính xác và đầy đủ</li>
                        <li>Việc đặt phòng chỉ được xác nhận sau khi thanh toán thành công</li>
                    </ul>

                    <h6 class="text-primary">2. Chính sách thanh toán</h6>
                    <ul>
                        <li>Thanh toán trực tiếp tại khách sạn khi nhận phòng</li>
                        <li>Chấp nhận các hình thức: Tiền mặt, thẻ tín dụng/ghi nợ</li>
                        <li>Giá phòng đã bao gồm VAT và phí dịch vụ</li>
                    </ul>

                    <h6 class="text-primary">3. Chính sách hủy và thay đổi</h6>
                    <ul>
                        <li>Hủy miễn phí trước 24 giờ so với thời gian nhận phòng</li>
                        <li>Hủy trong vòng 24 giờ sẽ tính phí 50% giá trị đặt phòng</li>
                        <li>Không xuất hiện (No-show) sẽ tính 100% giá trị đặt phòng</li>
                    </ul>

                    <h6 class="text-primary">4. Chính sách nhận và trả phòng</h6>
                    <ul>
                        <li>Thời gian nhận phòng: 14:00 - 23:00</li>
                        <li>Thời gian trả phòng: 06:00 - 12:00</li>
                        <li>Trả phòng muộn có thể phát sinh phí bổ sung</li>
                    </ul>

                    <h6 class="text-primary">5. Quy định chung</h6>
                    <ul>
                        <li>Không hút thuốc trong phòng</li>
                        <li>Không mang theo vật nuôi</li>
                        <li>Giữ trật tự và không làm ồn sau 22:00</li>
                        <li>Khách sạn có quyền từ chối phục vụ nếu vi phạm quy định</li>
                    </ul>

                    <h6 class="text-primary">6. Trách nhiệm và bồi thường</h6>
                    <ul>
                        <li>Khách hàng chịu trách nhiệm bồi thường thiệt hại do mình gây ra</li>
                        <li>Khách sạn không chịu trách nhiệm về tài sản cá nhân của khách</li>
                        <li>Sử dụng két sắt để bảo quản tài sản có giá trị</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="acceptTerms()" data-bs-dismiss="modal">
                    <i class="fas fa-check me-2"></i>Tôi đồng ý
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Cập nhật tóm tắt đặt phòng
            function updateSummary() {
                const checkinDate = $('#CheckInDate').val();
                const checkoutDate = $('#CheckOutDate').val();
                const guestCount = $('#GuestCount').val();
                
                // Cập nhật ngày
                $('#summary-checkin').text(checkinDate ? new Date(checkinDate).toLocaleDateString('vi-VN') : 'Chưa chọn');
                $('#summary-checkout').text(checkoutDate ? new Date(checkoutDate).toLocaleDateString('vi-VN') : 'Chưa chọn');
                $('#summary-guests').text(guestCount ? guestCount + ' khách' : 'Chưa chọn');
                
                // Tính toán số đêm và tổng tiền
                if (checkinDate && checkoutDate) {
                    const nights = Math.floor((new Date(checkoutDate) - new Date(checkinDate)) / (1000 * 60 * 60 * 24));
                    if (nights > 0) {
                        $('#summary-nights').text(nights);
                        const pricePerNight = parseFloat('@Model.RoomPrice');
                        const totalPrice = pricePerNight * nights;
                        $('#summary-total').text(totalPrice.toLocaleString('vi-VN') + '₫');
                        
                        // Hiện thông báo tiết kiệm nếu ở nhiều đêm
                        if (nights >= 3) {
                            showDiscountNotification(nights);
                        }
                    } else {
                        $('#summary-nights').text('0');
                        $('#summary-total').text('0₫');
                    }
                } else {
                    $('#summary-nights').text('0');
                    $('#summary-total').text('0₫');
                }
            }

            // Hiển thị thông báo ưu đãi cho khách ở lâu
            function showDiscountNotification(nights) {
                if (!$('.discount-notification').length) {
                    const notification = `
                        <div class="discount-notification alert alert-success mt-2" role="alert">
                            <i class="fas fa-gift text-success me-2"></i>
                            <strong>Ưu đãi đặc biệt!</strong> Ở ${nights} đêm - Tặng kèm bữa sáng miễn phí!
                        </div>
                    `;
                    $('.booking-summary').append(notification);
                }
            }

            // Kiểm tra tình trạng phòng theo thời gian thực
            function checkRoomAvailability() {
                const checkinDate = $('#CheckInDate').val();
                const checkoutDate = $('#CheckOutDate').val();
                
                if (checkinDate && checkoutDate) {
                    // Giả lập kiểm tra tình trạng phòng
                    $('.availability-status').remove();
                    const statusHtml = `
                        <div class="availability-status alert alert-success mt-2" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            Phòng có sẵn trong thời gian này
                        </div>
                    `;
                    $('.booking-summary').append(statusHtml);
                }
            }

            // Ràng buộc ngày
            const today = new Date().toISOString().split('T')[0];
            $('#CheckInDate').attr('min', today);
            
            $('#CheckInDate').on('change', function() {
                const checkinDate = new Date(this.value);
                const minCheckout = new Date(checkinDate);
                minCheckout.setDate(checkinDate.getDate() + 1);
                $('#CheckOutDate').attr('min', minCheckout.toISOString().split('T')[0]);
                
                // Nếu ngày checkout nhỏ hơn minimum, reset
                const currentCheckout = new Date($('#CheckOutDate').val());
                if (currentCheckout <= checkinDate) {
                    $('#CheckOutDate').val('');
                }
                updateSummary();
                checkRoomAvailability();
            });

            // Event listeners
            $('#CheckInDate, #CheckOutDate, #GuestCount').on('change', function() {
                updateSummary();
                checkRoomAvailability();
            });
            
            // Validation form với thông báo chi tiết
            $('form').on('submit', function(e) {
                const checkinDate = $('#CheckInDate').val();
                const checkoutDate = $('#CheckOutDate').val();
                const guestCount = $('#GuestCount').val();
                const termsAccepted = $('#terms-agreement').is(':checked');
                
                if (!checkinDate || !checkoutDate) {
                    e.preventDefault();
                    showAlert('Vui lòng chọn ngày nhận phòng và trả phòng', 'warning');
                    return false;
                }
                
                if (!guestCount) {
                    e.preventDefault();
                    showAlert('Vui lòng chọn số khách', 'warning');
                    return false;
                }
                
                if (!termsAccepted) {
                    e.preventDefault();
                    showAlert('Vui lòng đồng ý với điều khoản và điều kiện', 'warning');
                    return false;
                }
                
                const nights = Math.floor((new Date(checkoutDate) - new Date(checkinDate)) / (1000 * 60 * 60 * 24));
                if (nights <= 0) {
                    e.preventDefault();
                    showAlert('Ngày trả phòng phải sau ngày nhận phòng', 'danger');
                    return false;
                }

                // Hiện loading spinner khi submit
                const submitBtn = $('button[type="submit"]');
                submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý...');
                submitBtn.prop('disabled', true);
            });
            
            // Payment method selection
            $('.payment-method input[type="radio"]').on('change', function() {
                $('.payment-method').removeClass('active');
                $(this).closest('.payment-method').addClass('active');
            });

            // Thêm tooltip cho các trường thông tin
            $('[data-bs-toggle="tooltip"]').tooltip();

            // Animation cho form sections
            $('.form-section').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's').addClass('fade-in');
            });

            // Progress indicator functionality
            function updateProgress() {
                const checkinDate = $('#CheckInDate').val();
                const checkoutDate = $('#CheckOutDate').val();
                const guestCount = $('#GuestCount').val();
                const firstName = $('#FirstName').val();
                const lastName = $('#LastName').val();
                const email = $('#Email').val();
                const phone = $('#Phone').val();
                const termsAccepted = $('#terms-agreement').is(':checked');

                // Step 1: Accommodation info
                if (checkinDate && checkoutDate && guestCount) {
                    $('.step-item[data-step="1"]').addClass('completed').removeClass('active');
                    $('.step-item[data-step="2"]').addClass('active');
                } else {
                    $('.step-item[data-step="1"]').addClass('active').removeClass('completed');
                    $('.step-item[data-step="2"], .step-item[data-step="3"], .step-item[data-step="4"]').removeClass('active completed');
                    return;
                }

                // Step 2: Customer info (always completed since readonly)
                if (firstName && lastName && email && phone) {
                    $('.step-item[data-step="2"]').addClass('completed').removeClass('active');
                    $('.step-item[data-step="3"]').addClass('active');
                } else {
                    $('.step-item[data-step="2"]').addClass('active').removeClass('completed');
                    $('.step-item[data-step="3"], .step-item[data-step="4"]').removeClass('active completed');
                    return;
                }

                // Step 3: Payment method (always Hotel payment - completed)
                $('.step-item[data-step="3"]').addClass('completed').removeClass('active');
                $('.step-item[data-step="4"]').addClass('active');

                // Step 4: Terms acceptance
                if (termsAccepted) {
                    $('.step-item[data-step="4"]').addClass('completed').removeClass('active');
                }
            }

            // Update progress when form fields change
            $('#CheckInDate, #CheckOutDate, #GuestCount, #terms-agreement').on('change', updateProgress);
            
            // Initial setup
            updateSummary();
            checkRoomAvailability();
            updateProgress();
        });

        // Function để chấp nhận điều khoản từ modal
        function acceptTerms() {
            $('#terms-agreement').prop('checked', true);
            showAlert('Đã chấp nhận điều khoản và điều kiện', 'success');
        }

        // Function hiển thị thông báo
        function showAlert(message, type) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            $('body').append(alertHtml);
            
            // Auto remove after 5 seconds
            setTimeout(function() {
                $('.alert').fadeOut();
            }, 5000);
        }

        // Keyboard shortcuts
        $(document).keydown(function(e) {
            // Ctrl/Cmd + Enter để submit form
            if ((e.ctrlKey || e.metaKey) && e.which === 13) {
                if ($('#terms-agreement').is(':checked')) {
                    $('form').submit();
                } else {
                    showAlert('Vui lòng đồng ý với điều khoản trước khi đặt phòng', 'warning');
                }
            }
        });
    </script>

    <style>
        .fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @@keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .discount-notification {
            border-left: 4px solid #28a745;
        }

        .availability-status {
            border-left: 4px solid #007bff;
        }

        .contact-support .support-hours {
            margin-top: 5px;
        }

        /* Styles for cancellation policy card */
        .cancellation-policy-card {
            background: white;
            border: 1px solid #e3e6f0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .cancellation-policy-card .card-header {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: white;
            padding: 15px 20px;
            border-bottom: none;
        }

        .cancellation-policy-card .card-body {
            padding: 20px;
        }

        .policy-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .policy-item-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .policy-item-card.success {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .policy-item-card.warning {
            border-left-color: #ffc107;
            background: #fffdf5;
        }

        .policy-item-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .policy-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
            color: white;
        }

        .policy-item-card.success .policy-icon {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .policy-item-card.warning .policy-icon {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .policy-text {
            display: flex;
            flex-direction: column;
        }

        .policy-text strong {
            color: #495057;
            font-weight: 600;
            font-size: 14px;
        }

        .policy-text span {
            color: #6c757d;
            font-size: 13px;
        }

        /* Progress indicator styles */
        .booking-progress-container {
            margin-bottom: 25px;
        }

        .booking-progress-card {
            background: white;
            border: 1px solid #e3e6f0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .progress-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            border-bottom: 1px solid #e3e6f0;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 30px 40px;
            background: #f8f9fa;
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            z-index: 2;
            flex-shrink: 0;
        }

        .step-connector {
            height: 3px;
            background: linear-gradient(90deg, #e9ecef 0%, #dee2e6 100%);
            flex: 1;
            margin: 0 15px;
            margin-top: -25px;
            border-radius: 2px;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e9ecef;
            border: 3px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .step-item.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .step-item.completed .step-circle {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }

        .step-item.completed ~ .step-connector {
            background: #28a745;
        }

        .step-label {
            font-size: 13px;
            font-weight: 500;
            color: #6c757d;
            white-space: nowrap;
            margin-top: 5px;
        }

        .step-item.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        /* Responsive styles */
        @@media (max-width: 768px) {
            .progress-steps {
                padding: 20px;
                flex-direction: column;
                gap: 20px;
            }
            
            .step-item {
                width: 100%;
                flex-direction: row;
                text-align: left;
                justify-content: flex-start;
            }
            
            .step-connector {
                display: none;
            }
            
            .step-circle {
                margin-bottom: 0;
                margin-right: 15px;
                width: 40px;
                height: 40px;
            }
            
            .step-label {
                font-size: 14px;
                margin-top: 0;
                align-self: center;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .policy-list {
                gap: 10px;
            }

            .info-card, .policy-item-card {
                padding: 12px;
            }

            .info-icon, .policy-icon {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }
            }
        }

        .terms-content h6 {
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .terms-content ul {
            margin-bottom: 15px;
        }

        .terms-content li {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        /* Cải thiện giao diện readonly fields */
        .form-control.bg-light {
            cursor: not-allowed;
            border-color: #e9ecef;
        }

        .alert-info .alert-link {
            text-decoration: none;
            font-weight: 600;
        }

        .alert-info .alert-link:hover {
            text-decoration: underline;
        }

        /* Styles for helpful info cards */
        .helpful-info-card {
            background: white;
            border: 1px solid #e3e6f0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .helpful-info-card .card-header {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 15px 20px;
            border-bottom: none;
        }

        .helpful-info-card .card-body {
            padding: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: flex-start;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .info-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
            color: white;
            font-size: 18px;
        }

        .info-icon {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .info-icon.wifi {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }

        .info-icon.parking {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .info-icon.breakfast {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .info-content h6 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .info-content p {
            color: #6c757d;
            font-size: 13px;
            line-height: 1.4;
        }

        /* Animation styles */
        .fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .policy-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            padding: 6px 0;
        }

        .policy-item i {
            font-size: 14px;
        }

        /* Responsive improvements */
        @@media (max-width: 768px) {
            .modal-lg {
                max-width: 95%;
            }
            
            .alert.position-fixed {
                right: 10px;
                left: 10px;
                min-width: auto;
            }

            .info-items {
                gap: 8px;
            }

            .info-item {
                padding: 8px;
            }
        }
    </style>
}
