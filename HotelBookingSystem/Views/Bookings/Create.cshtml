@model HotelBookingSystem.ViewModels.Booking.BookingViewModel
@{
    ViewData["Title"] = "Đặt phòng";
}

@section Styles {
    <link rel="stylesheet" href="~/css/booking-scoped.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
}

<div class="booking-page">
<div class="container-fluid">
    <!-- Page Header -->
    <div class="booking-header fade-in-up">
        <h1><i class="fas fa-bed"></i> Đặt phòng khách sạn</h1>
        <p>Hoàn tất thông tin dưới đây để đặt phòng của bạn</p>
    </div>

    <!-- Progress Steps -->
    <div class="booking-steps fade-in-up">
        <div class="booking-step active">
            <div class="step-number">1</div>
            <div class="step-text">Thông tin đặt phòng</div>
        </div>
        <div class="step-connector"></div>
        <div class="booking-step">
            <div class="step-number">2</div>
            <div class="step-text">Thanh toán</div>
        </div>
        <div class="step-connector"></div>
        <div class="booking-step">
            <div class="step-number">3</div>
            <div class="step-text">Xác nhận</div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Main Booking Form -->
            <div class="booking-form-container fade-in-up">

    <div class="row">
                <form method="post" asp-action="Create" asp-controller="Bookings">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-4"></div>
                        <input type="hidden" asp-for="RoomId" />

                        <!-- Stay Details Section -->
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-calendar-check"></i> Thông tin lưu trú</h3>

                            <div class="row mb-3">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label asp-for="CheckInDate" class="form-label">Ngày nhận phòng</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                        <input asp-for="CheckInDate" type="date" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="CheckInDate" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="CheckOutDate" class="form-label">Ngày trả phòng</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                        <input asp-for="CheckOutDate" type="date" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="CheckOutDate" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label asp-for="GuestCount" class="form-label">Số khách</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-users"></i></span>
                                        <select asp-for="GuestCount" class="form-select" required>
                                            <option value="">Chọn số khách</option>
                                            <option value="1">1 khách</option>
                                            <option value="2">2 khách</option>
                                            <option value="3">3 khách</option>
                                            <option value="4">4 khách</option>
                                            <option value="5">5 khách</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="GuestCount" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-12">
                                    <label asp-for="SpecialRequests" class="form-label">Yêu cầu đặc biệt</label>
                                    <textarea asp-for="SpecialRequests" class="form-control" rows="3" placeholder="Vui lòng cho chúng tôi biết nếu bạn có yêu cầu đặc biệt (không đảm bảo)"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Guest Information Section -->
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-user-friends"></i> Thông tin khách hàng</h3>

                            <div class="row mb-3">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label asp-for="FirstName" class="form-label">Tên</label>
                                    <input asp-for="FirstName" type="text" class="form-control" required />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="LastName" class="form-label">Họ</label>
                                    <input asp-for="LastName" type="text" class="form-control" required />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label asp-for="Email" class="form-label">Email</label>
                                    <div class="input-group">
                                        <span class="input-group-text">@@</span>
                                        <input asp-for="Email" type="email" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Phone" class="form-label">Số điện thoại</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                        <input asp-for="Phone" type="tel" class="form-control" required />
                                    </div>
                                    <span asp-validation-for="Phone" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Method Section -->
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-credit-card"></i> Phương thức thanh toán</h3>

                            <div class="payment-methods">
                                <div class="payment-method-item active">
                                    <input type="radio" id="hotel-payment" name="PaymentMethod" value="Hotel" checked />
                                    <label for="hotel-payment" class="payment-method-label">
                                        <div class="payment-icon">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div class="payment-info">
                                            <div class="payment-title">Thanh toán tại khách sạn</div>
                                            <div class="payment-description">Thanh toán trực tiếp tại quầy lễ tân khi nhận phòng</div>
                                        </div>
                                        <div class="payment-status">
                                            <span class="badge bg-success">Khuyến nghị</span>
                                        </div>
                                    </label>
                                </div>

                                <div class="payment-method-item disabled">
                                    <input type="radio" id="credit-card" name="PaymentMethod" value="CreditCard" disabled />
                                    <label for="credit-card" class="payment-method-label">
                                        <div class="payment-icon">
                                            <i class="fas fa-credit-card"></i>
                                        </div>
                                        <div class="payment-info">
                                            <div class="payment-title">Thẻ tín dụng</div>
                                            <div class="payment-description">Thanh toán bằng thẻ tín dụng (Sắp có)</div>
                                        </div>
                                        <div class="payment-status">
                                            <span class="badge bg-secondary">Sắp có</span>
                                        </div>
                                    </label>
                                </div>

                                <div class="payment-method-item disabled">
                                    <input type="radio" id="bank-transfer" name="PaymentMethod" value="BankTransfer" disabled />
                                    <label for="bank-transfer" class="payment-method-label">
                                        <div class="payment-icon">
                                            <i class="fas fa-university"></i>
                                        </div>
                                        <div class="payment-info">
                                            <div class="payment-title">Chuyển khoản ngân hàng</div>
                                            <div class="payment-description">Chuyển khoản qua ngân hàng (Sắp có)</div>
                                        </div>
                                        <div class="payment-status">
                                            <span class="badge bg-secondary">Sắp có</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-section mb-4">
                            <div class="terms-agreement">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="terms-agreement" required>
                                    <label class="form-check-label" for="terms-agreement">
                                        Tôi đồng ý với <a href="#" class="text-primary">Điều khoản và điều kiện</a> của khách sạn
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center mt-5">
                            <a href="javascript:history.back()" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Quay lại
                            </a>
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-check me-2"></i>Hoàn tất đặt phòng
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Booking Summary -->
        <div class="col-lg-4">
            <div class="booking-summary slide-in-right">
                <div class="summary-card">
                    <div class="summary-header">
                        <h5 class="summary-title">Tóm tắt đặt phòng</h5>
                        <p class="summary-subtitle">Kiểm tra thông tin trước khi xác nhận</p>
                    </div>
                    
                    <!-- Room Preview -->
                    <div class="room-preview"
                        <div class="room-image mb-3">
                            <img src="@Model.RoomImageUrl" alt="@Model.RoomName" class="img-fluid rounded">
                        </div>
                        <img src="https://via.placeholder.com/300x180?text=Hotel+Room" 
                             alt="@Model.RoomName" class="room-image">
                        <h6 class="room-name">@Model.RoomName</h6>
                        <p class="room-type">@Model.RoomType</p>
                    </div>

                    <!-- Stay Details -->
                    <div class="summary-details">
                        <div class="summary-row">
                            <span class="summary-label">Ngày nhận phòng:</span>
                            <span class="summary-value" id="summary-checkin">Chưa chọn</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Ngày trả phòng:</span>
                            <span class="summary-value" id="summary-checkout">Chưa chọn</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Số đêm:</span>
                            <span class="summary-value" id="summary-nights">0</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Số khách:</span>
                            <span class="summary-value" id="summary-guests">Chưa chọn</span>
                        </div>
                    </div>

                        <div class="summary-row">
                            <span class="summary-label">Giá phòng/đêm:</span>
                            <span class="summary-value">@Model.RoomPrice.ToString("C0")</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Số đêm:</span>
                            <span class="summary-value" id="summary-nights-price">0</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label"><strong>Tổng cộng:</strong></span>
                            <span class="summary-value price-highlight"><strong id="summary-total">0đ</strong></span>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="mt-4 p-3 bg-light rounded">
                        <div class="text-center">
                            <i class="fas fa-headset text-primary mb-2" style="font-size: 1.5rem;"></i>
                            <p class="mb-1"><small>Cần hỗ trợ?</small></p>
                            <p class="mb-0"><strong class="text-primary">(024) 3825 0888</strong></p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Enhanced animations and interactions
            function addUpdateAnimation(element) {
                element.addClass('updating');
                setTimeout(() => element.removeClass('updating'), 300);
            }
            
            // Auto-fill dates and calculate price with animations
            function updateSummary() {
                const checkinDate = $('#CheckInDate').val();
                const checkoutDate = $('#CheckOutDate').val();
                const guestCount = $('#GuestCount').val();
                
                const checkinSummary = $('#summary-checkin');
                const checkoutSummary = $('#summary-checkout');
                const guestsSummary = $('#summary-guests');
                const nightsSummary = $('#summary-nights');
                const totalSummary = $('#summary-total');
                
                // Update with animations
                checkinSummary.text(checkinDate ? new Date(checkinDate).toLocaleDateString('vi-VN') : 'Chưa chọn');
                addUpdateAnimation(checkinSummary);
                
                checkoutSummary.text(checkoutDate ? new Date(checkoutDate).toLocaleDateString('vi-VN') : 'Chưa chọn');
                addUpdateAnimation(checkoutSummary);
                
                guestsSummary.text(guestCount ? guestCount + ' khách' : 'Chưa chọn');
                addUpdateAnimation(guestsSummary);
                
                if (checkinDate && checkoutDate) {
                    const nights = Math.floor((new Date(checkoutDate) - new Date(checkinDate)) / (1000 * 60 * 60 * 24));

                    if (nights > 0) {
                        nightsSummary.text(nights);
                        addUpdateAnimation(nightsSummary);
                        
                        $('#summary-nights-price').text('x' + nights);

                        const pricePerNight = parseFloat('@Model.RoomPrice');
                        const totalPrice = pricePerNight * nights;
                        totalSummary.text(totalPrice.toLocaleString('vi-VN') + 'đ');
                        addUpdateAnimation(totalSummary);
                    } else {
                        nightsSummary.text('0');
                        $('#summary-nights-price').text('x0');
                        totalSummary.text('0đ');
                    }
                } else {
                    nightsSummary.text('0');
                    $('#summary-nights-price').text('x0');
                    totalSummary.text('0đ');
                }
            }

            // Enhanced form validation
            function validateForm() {
                let isValid = true;
                const requiredFields = ['CheckInDate', 'CheckOutDate', 'GuestCount', 'FirstName', 'LastName', 'Email', 'Phone'];
                
                requiredFields.forEach(fieldName => {
                    const field = $(`#${fieldName}`);
                    const value = field.val().trim();
                    
                    if (!value) {
                        field.addClass('is-invalid');
                        isValid = false;
                    } else {
                        field.removeClass('is-invalid');
                    }
                });
                
                return isValid;
            }

            // Event handlers
            $('#CheckInDate, #CheckOutDate, #GuestCount').on('change', updateSummary);

            // Enhanced date validation
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayString = today.toISOString().split('T')[0];
            $('#CheckInDate').attr('min', todayString);

            $('#CheckInDate').on('change', function() {
                const checkinDate = new Date(this.value);
                if (!isNaN(checkinDate.getTime())) {
                    const minCheckout = new Date(checkinDate);
                    minCheckout.setDate(checkinDate.getDate() + 1);
                    $('#CheckOutDate').attr('min', minCheckout.toISOString().split('T')[0]);

                    const currentCheckoutDate = new Date($('#CheckOutDate').val());
                    if (currentCheckoutDate < minCheckout) {
                        $('#CheckOutDate').val(minCheckout.toISOString().split('T')[0]);
                        $('#CheckOutDate').trigger('change');
                    }
                }
            });

            // Form submission with loading state
            $('form').on('submit', function(e) {
                if (!validateForm()) {
                    e.preventDefault();
                    return false;
                }
                
                const submitBtn = $('.btn-submit');
                submitBtn.addClass('btn-loading');
                submitBtn.prop('disabled', true);
            });

            // Real-time validation
            $('input, select, textarea').on('blur', function() {
                const field = $(this);
                if (field.prop('required') && !field.val().trim()) {
                    field.addClass('is-invalid');
                } else {
                    field.removeClass('is-invalid');
                }
            });

            // Payment method selection enhancement
            $('.payment-method-item input[type="radio"]').on('change', function() {
                $('.payment-method-item').removeClass('active');
                $(this).closest('.payment-method-item').addClass('active');
            });

            // Initial setup
            updateSummary();
            
            // Add loading animation to page elements
            $('.fade-in-up').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
            });
            
            $('.slide-in-right').css('animation-delay', '0.3s');
        });
    </script>
}
